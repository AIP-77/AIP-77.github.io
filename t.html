<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ —Å–∫–ª–∞–¥–∞ –ø–æ –ò—Å—Ö–æ–¥—è—â–µ–º—É –ø–æ—Ç–æ–∫—É</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; margin-bottom: 10px; }
        .controls { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; flex-wrap: wrap; }
        .controls label { font-weight: 600; white-space: nowrap; }
        .controls select { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; min-width: 150px; }
        .controls button { padding: 8px 16px; background: #1a73e8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
        .controls button:hover { background: #1557b0; }
        .controls button:disabled { background: #ccc; cursor: not-allowed; }
        .stats-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #e8f0fe; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #d2e3fc; }
        .stat-card span { display: block; font-size: 0.9em; color: #555; }
        .stat-card strong { font-size: 1.2em; color: #1a73e8; }
        .chart-container { position: relative; height: 350px; width: 100%; margin-bottom: 60px; padding-bottom: 20px; border-bottom: 1px dashed #ccc; }
        h2 { border-left: 5px solid #1a73e8; padding-left: 10px; font-size: 1.3em; margin-top: 40px; }
        .status { text-align: center; color: #666; font-style: italic; min-height: 1.2em; }
        .error { color: #c62828; font-weight: 500; }
        .success { color: #2e7d32; }
    </style>
</head>
<body>

<div class="container">
    <h1>–ê–Ω–∞–ª–∏–∑ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ —Å–∫–ª–∞–¥–∞ –ø–æ –ò—Å—Ö–æ–¥—è—â–µ–º—É –ø–æ—Ç–æ–∫—É</h1>

    <div class="controls">
        <label for="dateSelect">üìÖ –î–∞—Ç–∞:</label>
        <select id="dateSelect" disabled><option>–ó–∞–≥—Ä—É–∑–∫–∞...</option></select>
        <button id="refreshBtn" disabled>üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <span id="status" class="status"></span>
    </div>
    
    <div class="stats-summary">
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –°–±–æ—Ä–∫–∏</span><strong>3 –±—Ä–∏–≥–∞–¥—ã (6 —á–µ–ª.)<br> 210 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –ü–æ–≥—Ä—É–∑–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (3 —á–µ–ª.)<br> 340 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –°—Ç–∏–∫–µ—Ä–æ–≤–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (2 —á–µ–ª.)<br> 150 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –£–ø–∞–∫–æ–≤–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (2 —á–µ–ª.)<br> 124 —à—Ç/—á</strong></div>
    </div>
   <p> –ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏:<br>
–¶–≤–µ—Ç–Ω–∞—è –ª–∏–Ω–∏—è: –≠—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–º –≤ —à—Ç—É–∫–∞—Ö –ø–æ —á–∞—Å–∞–º.<br>
–°–µ—Ä—ã–µ —Å—Ç–æ–ª–±—Ü—ã: –≠—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–∏–≥–∞–¥, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–≤–µ—Å—Ç–∏ –≤ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Å, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å –æ–±—ä–µ–º —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º.<br>
–ü–∏–∫–∏: –ï—Å–ª–∏ —Å—Ç–æ–ª–±–µ—Ü —Ä–µ–∑–∫–æ —É—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö, –∑–Ω–∞—á–∏—Ç, –≤ —ç—Ç–æ—Ç —á–∞—Å –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ–¥–Ω—É –±—Ä–∏–≥–∞–¥—É –ø—Ä–µ–≤—ã—à–∞–µ—Ç –Ω–æ—Ä–º—É, –∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á.</p>
    <h2>1. –°–±–æ—Ä–∫–∞ –®–∏–Ω (–õ—é–±—ã–µ –≤–∏–¥—ã)</h2>
    <div class="chart-container"><canvas id="chartAssembly"></canvas></div>

    <h2>2. –ü–æ–≥—Ä—É–∑–∫–∞</h2>
    <div class="chart-container"><canvas id="chartLoading"></canvas></div>

    <h2>3. –°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞</h2>
    <div class="chart-container"><canvas id="chartStickering"></canvas></div>

    <h2>4. –£–ø–∞–∫–æ–≤–∫–∞ –≤ –ø–∞–ª–ª–µ—Ç</h2>
    <div class="chart-container"><canvas id="chartPalletizing"></canvas></div>
</div>

<script>
    // üîó –ü–†–ê–í–ò–õ–¨–ù–´–ô RAW-URL –¥–ª—è GitHub (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ raw.githubusercontent.com)
    const DATA_URL = 'https://raw.githubusercontent.com/AIP-77/AIP-77.github.io/main/archive/2026-02%20fullData.json';
    
    const labels = ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00",
                    "21:00","22:00","23:00","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00"];
    
    const norms = { assembly: 210, loading: 340, stickering: 150, palletizing: 124 };
    const workTypeMap = {
        '–°–±–æ—Ä–∫–∞ –®–∏–Ω—ã': 'assembly', '–°–±–æ—Ä–∫–∞ –®–∏–Ω—ã-–∑–æ–Ω–∞ –ê': 'assembly', '–°–±–æ—Ä–∫–∞ —à–∏–Ω—ã –ú–ü': 'assembly', '–°–±–æ—Ä–∫–∞ –®–∏–Ω—ã (–ò—Å–∫–ª—é—á–µ–Ω–∏–µ)': 'assembly',
        '–ü–æ–≥—Ä—É–∑–∫–∞': 'loading', '–ü–æ–≥—Ä—É–∑–∫–∞/–†–∞–∑–≥—Ä—É–∑–∫–∞': 'loading',
        '–°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞ –®–∏–Ω—ã': 'stickering', '–°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞ –î–∏—Å–∫–∏': 'stickering',
        '–£–ø–∞–∫–æ–≤–∫–∞ –ø–∞–ª–ª–µ—Ç—ã': 'palletizing', '–ü–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ': 'palletizing', '–£–ø–∞–∫–æ–≤–∫–∞': 'palletizing'
    };

    let jsonData = null;
    let charts = {};
    const dateSelect = document.getElementById('dateSelect');
    const refreshBtn = document.getElementById('refreshBtn');
    const statusEl = document.getElementById('status');

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
    async function loadData() {
        setStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'loading');
        toggleControls(false);
        
        try {
            const response = await fetch(DATA_URL, { cache: 'no-cache' });
            if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            jsonData = await response.json();
            
            if (!jsonData.data || !jsonData.columns) throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON');
            
            populateDateSelect();
            setStatus('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
            toggleControls(true);
            
            // –ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–∞—Ç—ã
            if (dateSelect.options.length > 1) {
                dateSelect.value = dateSelect.options[dateSelect.options.length - 1].value;
                updateCharts(dateSelect.value);
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
            setStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ URL —Ñ–∞–π–ª–∞.`, 'error');
            dateSelect.innerHTML = '<option>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</option>';
        }
    }

    function setStatus(message, type) {
        statusEl.textContent = message;
        statusEl.className = `status ${type === 'error' ? 'error' : type === 'success' ? 'success' : ''}`;
    }

    function toggleControls(enabled) {
        dateSelect.disabled = !enabled;
        refreshBtn.disabled = !enabled;
    }

    function populateDateSelect() {
        const dates = new Set();
        const dateCol = jsonData.columns.indexOf('–†–∞–±–æ—á–∏–π –¥–µ–Ω—å');
        if (dateCol === -1) throw new Error('–ö–æ–ª–æ–Ω–∫–∞ "–†–∞–±–æ—á–∏–π –¥–µ–Ω—å" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        
        jsonData.data.forEach(row => {
            if (row[dateCol]) dates.add(row[dateCol]);
        });
        
        dateSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É --</option>';
        [...dates].sort().forEach(date => {
            const opt = document.createElement('option');
            opt.value = date;
            opt.textContent = date;
            dateSelect.appendChild(opt);
        });
    }

    function getHourLabel(timeStr) {
        if (!timeStr) return null;
        const parts = timeStr.split(':');
        const h = parseInt(parts[0]);
        return (h < 10 ? '0' : '') + h + ':00';
    }

    function calculateDataForDate(selectedDate) {
        const result = { 
            assembly: Array(24).fill(0), 
            loading: Array(24).fill(0), 
            stickering: Array(24).fill(0), 
            palletizing: Array(24).fill(0) 
        };
        
        const dateCol = jsonData.columns.indexOf('–†–∞–±–æ—á–∏–π –¥–µ–Ω—å');
        const timeCol = jsonData.columns.indexOf('–ù–∞—á–∞–ª–æ –∑–∞–¥–∞—á–∏');
        const workCol = jsonData.columns.indexOf('–í–∏–¥ —Ä–∞–±–æ—Ç');
        const qtyCol = jsonData.columns.indexOf('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü');

        jsonData.data.forEach(row => {
            if (row[dateCol] !== selectedDate) return;
            const workTypeRaw = row[workCol] || '';
            const key = workTypeMap[workTypeRaw];
            if (!key) return;
            const hourLabel = getHourLabel(row[timeCol]);
            if (!hourLabel) return;
            const hourIdx = labels.indexOf(hourLabel);
            if (hourIdx === -1) return;
            const qty = parseFloat(row[qtyCol]) || 0;
            result[key][hourIdx] += qty;
        });
        return result;
    }

    function createOrUpdateChart(canvasId, data, color, norm) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        const fteData = data.map(val => (val / norm).toFixed(2));
        
        if (charts[canvasId]) {
            charts[canvasId].data.datasets[0].data = data;
            charts[canvasId].data.datasets[1].data = fteData;
            charts[canvasId].update('none'); // 'none' –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
            return;
        }
        
        charts[canvasId] = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '–û–±—ä–µ–º (—à—Ç—É–∫)',
                        data: data,
                        backgroundColor: color + '22',
                        borderColor: color,
                        borderWidth: 2,
                        yAxisID: 'y',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 2,
                        pointHoverRadius: 4
                    },
                    {
                        label: '–¢—Ä–µ–±—É–µ–º—ã–π —Ä–µ—Å—É—Ä—Å (–±—Ä–∏–≥–∞–¥/—á–∞—Å)',
                        data: fteData,
                        type: 'bar',
                        backgroundColor: '#34495e88',
                        yAxisID: 'y1',
                        barThickness: 20
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 300 },
                scales: {
                    y: { 
                        type: 'linear', 
                        position: 'left', 
                        title: { display: true, text: '–®—Ç—É–∫–∏' }, 
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' }
                    },
                    y1: { 
                        type: 'linear', 
                        position: 'right', 
                        title: { display: true, text: '–†–µ—Å—É—Ä—Å (–ë—Ä–∏–≥–∞–¥–∞)' }, 
                        grid: { drawOnChartArea: false },
                        beginAtZero: true 
                    }
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            afterLabel: function(context) {
                                if (context.datasetIndex === 0) {
                                    const val = context.raw;
                                    return `–ó–∞–≥—Ä—É–∑–∫–∞: ${(val/norm).toFixed(2)} –±—Ä–∏–≥–∞–¥/—á–∞—Å`;
                                }
                            }
                        }
                    },
                    legend: { labels: { font: { size: 11 } } }
                }
            }
        });
    }

    function updateCharts(selectedDate) {
        if (!selectedDate || !jsonData) return;
        setStatus(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ ${selectedDate}...`, 'loading');
        
        setTimeout(() => {
            try {
                const data = calculateDataForDate(selectedDate);
                createOrUpdateChart('chartAssembly', data.assembly, '#4285F4', norms.assembly);
                createOrUpdateChart('chartLoading', data.loading, '#EA4335', norms.loading);
                createOrUpdateChart('chartStickering', data.stickering, '#FBBC05', norms.stickering);
                createOrUpdateChart('chartPalletizing', data.palletizing, '#34A853', norms.palletizing);
                setStatus(`–ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∑–∞ ${selectedDate}`, 'success');
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', e);
                setStatus(`–û—à–∏–±–∫–∞: ${e.message}`, 'error');
            }
        }, 30);
    }

    // –°–æ–±—ã—Ç–∏—è
    dateSelect.addEventListener('change', (e) => updateCharts(e.target.value));
    refreshBtn.addEventListener('click', () => loadData());

    // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
