<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ —Å–∫–ª–∞–¥–∞ –ø–æ –ò—Å—Ö–æ–¥—è—â–µ–º—É –ø–æ—Ç–æ–∫—É</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1a73e8; margin-bottom: 10px; }
        .controls { display: flex; gap: 15px; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .controls label { font-weight: 600; }
        .controls select { padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .stats-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #e8f0fe; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #d2e3fc; }
        .stat-card span { display: block; font-size: 0.9em; color: #555; }
        .stat-card strong { font-size: 1.2em; color: #1a73e8; }
        .chart-container { position: relative; height: 350px; width: 100%; margin-bottom: 60px; padding-bottom: 20px; border-bottom: 1px dashed #ccc; }
        h2 { border-left: 5px solid #1a73e8; padding-left: 10px; font-size: 1.3em; margin-top: 40px; }
        .loading { text-align: center; color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>–ê–Ω–∞–ª–∏–∑ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ —Å–∫–ª–∞–¥–∞ –ø–æ –ò—Å—Ö–æ–¥—è—â–µ–º—É –ø–æ—Ç–æ–∫—É</h1>

    <div class="controls">
        <label for="dateSelect">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
        <select id="dateSelect"><option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç...</option></select>
        <span id="loadingStatus" class="loading"></span>
    </div>
    
    <div class="stats-summary">
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –°–±–æ—Ä–∫–∏</span><strong>3 –±—Ä–∏–≥–∞–¥—ã (6 —á–µ–ª.)<br> 210 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –ü–æ–≥—Ä—É–∑–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (3 —á–µ–ª.)<br> 340 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –°—Ç–∏–∫–µ—Ä–æ–≤–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (2 —á–µ–ª.)<br> 150 —à—Ç/—á</strong></div>
        <div class="stat-card"><span>–ù–æ—Ä–º–∞ –£–ø–∞–∫–æ–≤–∫–∏</span><strong>1 –±—Ä–∏–≥–∞–¥–∞ (2 —á–µ–ª.)<br> 124 —à—Ç/—á</strong></div>
    </div>
   <p> –ö–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏:<br>
–¶–≤–µ—Ç–Ω–∞—è –ª–∏–Ω–∏—è: –≠—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∏–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–º –≤ —à—Ç—É–∫–∞—Ö –ø–æ —á–∞—Å–∞–º.<br>
–°–µ—Ä—ã–µ —Å—Ç–æ–ª–±—Ü—ã: –≠—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–∏–≥–∞–¥, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–≤–µ—Å—Ç–∏ –≤ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Å, —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å –æ–±—ä–µ–º —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º.<br>
–ü–∏–∫–∏: –ï—Å–ª–∏ —Å—Ç–æ–ª–±–µ—Ü —Ä–µ–∑–∫–æ —É—Ö–æ–¥–∏—Ç –≤–≤–µ—Ä—Ö, –∑–Ω–∞—á–∏—Ç, –≤ —ç—Ç–æ—Ç —á–∞—Å –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ–¥–Ω—É –±—Ä–∏–≥–∞–¥—É –ø—Ä–µ–≤—ã—à–∞–µ—Ç –Ω–æ—Ä–º—É, –∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å–∏–ª–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á.</p>
    <h2>1. –°–±–æ—Ä–∫–∞ (–õ—é–±—ã–µ –≤–∏–¥—ã)</h2>
    <div class="chart-container"><canvas id="chartAssembly"></canvas></div>

    <h2>2. –ü–æ–≥—Ä—É–∑–∫–∞</h2>
    <div class="chart-container"><canvas id="chartLoading"></canvas></div>

    <h2>3. –°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞</h2>
    <div class="chart-container"><canvas id="chartStickering"></canvas></div>

    <h2>4. –£–ø–∞–∫–æ–≤–∫–∞ –≤ –ø–∞–ª–ª–µ—Ç</h2>
    <div class="chart-container"><canvas id="chartPalletizing"></canvas></div>
</div>

<script>
    // ========== –í–°–¢–ê–í–¨–¢–ï –í–ê–® JSON –°–Æ–î–ê ==========
    
 fetch('https://github.com/AIP-77/AIP-77.github.io/blob/main/archive/2026-02%20fullData.json')
  .then(r => r.json())
  .then(data => { jsonData = data; init(); });
    
    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–Ω–µ—à–Ω–µ–º —Ñ–∞–π–ª–µ - –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ fetch('data.json').then(r => r.json())
   /* const jsonData = {
        "lastUpdated":"2026-02-27T03:59:17.636Z",
        "columns":["–†–∞–±–æ—á–∏–π –¥–µ–Ω—å","–ù–∞—á–∞–ª–æ –∑–∞–¥–∞—á–∏","–°–æ—Ç—Ä—É–¥–Ω–∏–∫","–í–∏–¥ —Ä–∞–±–æ—Ç","–í–∏–¥ —Ä–∞–±–æ—Ç-–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ","–ü–æ—Å—Ç–∞–≤–∫–∞","–î–æ–ª–∂–Ω–æ—Å—Ç—å","—Ç–∏–ø —Ç–æ–≤–∞—Ä–∞","–ï–¥–∏–Ω–∏—Ü–∞ —Ä–∞—Å—á–µ—Ç–∞","–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü","–†–∞—Å—Ü–µ–Ω–∫–∞","–í—Ä–µ–º—è –ø–æ —Ç–∞–±–µ–ª—é","–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è","–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–¥–∞—á–∏","–†–∞—Å—á–µ—Ç–Ω–∞—è —Å—É–º–º–∞","–î–æ–ø–ª–∞—Ç–∞ XIS","–ö–æ–Ω–µ—Ü –∑–∞–¥–∞—á–∏","–ò—Å—Ç–æ—á–Ω–∏–∫","–û—Ç–º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏"],
        "data":[
            ["01.02.2026","8:21:44","–ú–∞–º–∞—à–∞—Ä–∏–ø–æ–≤ –ú–∞—Ö–∞–º–∞–¥–∞–ª–∏","–°–±–æ—Ä–∫–∞","","","","","","",150,"","5:44:00","","","—Ä.3 096,00","","15:05:45","–°–æ–∑–¥–∞–Ω–∏–µ JSON","8:59:17"],
            ["01.02.2026","8:45:00","–ò–≤–∞–Ω–æ–≤ –ò.","–ü–æ–≥—Ä—É–∑–∫–∞","","","","","","",200,"","", "","","","","","15:30:00","–°–æ–∑–¥–∞–Ω–∏–µ JSON",""],
            ["01.02.2026","9:15:00","–ü–µ—Ç—Ä–æ–≤ –ü.","–°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞","","","","","","",80,"","", "","","","","","16:00:00","–°–æ–∑–¥–∞–Ω–∏–µ JSON",""],
            ["01.02.2026","10:00:00","–°–∏–¥–æ—Ä–æ–≤ –°.","–£–ø–∞–∫–æ–≤–∫–∞ –≤ –ø–∞–ª–ª–µ—Ç","","","","","","",120,"","", "","","","","","17:00:00","–°–æ–∑–¥–∞–Ω–∏–µ JSON",""],
            ["02.02.2026","8:00:00","–ò–≤–∞–Ω–æ–≤ –ò.","–°–±–æ—Ä–∫–∞","","","","","","",300,"","", "","","","","","14:00:00","–°–æ–∑–¥–∞–Ω–∏–µ JSON",""]
            // ... –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
        ]
    };*/
    // ============================================

    const labels = ["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00",
                    "12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"];
    
    const norms = { assembly: 210, loading: 340, stickering: 150, palletizing: 124 };
    const workTypeMap = {
        '–°–±–æ—Ä–∫–∞': 'assembly',
        '–°–±–æ—Ä–∫–∞ (–ª—é–±–∞—è)': 'assembly',
        '–ü–æ–≥—Ä—É–∑–∫–∞': 'loading',
        '–ü–æ–≥—Ä—É–∑–∫–∞/–†–∞–∑–≥—Ä—É–∑–∫–∞': 'loading',
        '–°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞': 'stickering',
        '–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞': 'stickering',
        '–£–ø–∞–∫–æ–≤–∫–∞ –≤ –ø–∞–ª–ª–µ—Ç': 'palletizing',
        '–ü–∞–ª–ª–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ': 'palletizing',
        '–£–ø–∞–∫–æ–≤–∫–∞': 'palletizing'
    };

    let charts = {};
    const dateSelect = document.getElementById('dateSelect');
    const loadingStatus = document.getElementById('loadingStatus');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    function init() {
        populateDateSelect();
        if (dateSelect.options.length > 1) {
            dateSelect.value = dateSelect.options[1].value;
            updateCharts(dateSelect.value);
        }
        dateSelect.addEventListener('change', (e) => updateCharts(e.target.value));
    }

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
    function populateDateSelect() {
        const dates = new Set();
        const dateCol = jsonData.columns.indexOf('–†–∞–±–æ—á–∏–π –¥–µ–Ω—å');
        jsonData.data.forEach(row => {
            if (row[dateCol]) dates.add(row[dateCol]);
        });
        dateSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É --</option>';
        [...dates].sort().forEach(date => {
            const opt = document.createElement('option');
            opt.value = date;
            opt.textContent = date;
            dateSelect.appendChild(opt);
        });
    }

    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ "8:21:44" ‚Üí "08:00"
    function getHourLabel(timeStr) {
        if (!timeStr) return null;
        const parts = timeStr.split(':');
        const h = parseInt(parts[0]);
        return (h < 10 ? '0' : '') + h + ':00';
    }

    // –ü–æ–¥—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∞—Ç–µ: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∞—Å–∞–º –∏ –≤–∏–¥–∞–º —Ä–∞–±–æ—Ç
    function calculateDataForDate(selectedDate) {
        const result = { assembly: Array(24).fill(0), loading: Array(24).fill(0), stickering: Array(24).fill(0), palletizing: Array(24).fill(0) };
        const dateCol = jsonData.columns.indexOf('–†–∞–±–æ—á–∏–π –¥–µ–Ω—å');
        const timeCol = jsonData.columns.indexOf('–ù–∞—á–∞–ª–æ –∑–∞–¥–∞—á–∏');
        const workCol = jsonData.columns.indexOf('–í–∏–¥ —Ä–∞–±–æ—Ç');
        const qtyCol = jsonData.columns.indexOf('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü');

        jsonData.data.forEach(row => {
            if (row[dateCol] !== selectedDate) return;
            const workTypeRaw = row[workCol] || '';
            const key = workTypeMap[workTypeRaw];
            if (!key) return;
            const hourLabel = getHourLabel(row[timeCol]);
            if (!hourLabel) return;
            const hourIdx = labels.indexOf(hourLabel);
            if (hourIdx === -1) return;
            const qty = parseFloat(row[qtyCol]) || 0;
            result[key][hourIdx] += qty;
        });
        return result;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
    function createOrUpdateChart(canvasId, label, data, color, norm) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        const fteData = data.map(val => (val / norm).toFixed(2));
        
        if (charts[canvasId]) {
            charts[canvasId].data.datasets[0].data = data;
            charts[canvasId].data.datasets[1].data = fteData;
            charts[canvasId].update();
            return;
        }
        
        charts[canvasId] = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '–û–±—ä–µ–º (—à—Ç—É–∫)',
                        data: data,
                        backgroundColor: color + '22',
                        borderColor: color,
                        borderWidth: 2,
                        yAxisID: 'y',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '–¢—Ä–µ–±—É–µ–º—ã–π —Ä–µ—Å—É—Ä—Å (–±—Ä–∏–≥–∞–¥/—á–∞—Å)',
                        data: fteData,
                        type: 'bar',
                        backgroundColor: '#34495e88',
                        yAxisID: 'y1',
                        barThickness: 20
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { type: 'linear', position: 'left', title: { display: true, text: '–®—Ç—É–∫–∏' }, beginAtZero: true },
                    y1: { type: 'linear', position: 'right', title: { display: true, text: '–†–µ—Å—É—Ä—Å (–ë—Ä–∏–≥–∞–¥–∞)' }, grid: { drawOnChartArea: false }, beginAtZero: true }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                if (context.datasetIndex === 0) {
                                    let val = context.raw;
                                    return `–ó–∞–≥—Ä—É–∑–∫–∞: ${(val/norm).toFixed(2)} –±—Ä–∏–≥–∞–¥/—á–∞—Å`;
                                }
                            }
                        }
                    }
                }
            }
        });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–µ
    function updateCharts(selectedDate) {
        if (!selectedDate) return;
        loadingStatus.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
        
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        setTimeout(() => {
            const data = calculateDataForDate(selectedDate);
            createOrUpdateChart('chartAssembly', '–°–±–æ—Ä–∫–∞', data.assembly, '#4285F4', norms.assembly);
            createOrUpdateChart('chartLoading', '–ü–æ–≥—Ä—É–∑–∫–∞', data.loading, '#EA4335', norms.loading);
            createOrUpdateChart('chartStickering', '–°—Ç–∏–∫–µ—Ä–æ–≤–∫–∞', data.stickering, '#FBBC05', norms.stickering);
            createOrUpdateChart('chartPalletizing', '–£–ø–∞–∫–æ–≤–∫–∞', data.palletizing, '#34A853', norms.palletizing);
            loadingStatus.textContent = `–î–∞–Ω–Ω—ã–µ –∑–∞ ${selectedDate}`;
        }, 50);
    }

    // –ó–∞–ø—É—Å–∫
    init();
</script>

</body>
</html>
